! Auto-generated file - do not edit manually
! Generated by generate_evaluate_matsubara.py
! Based on template from tmp.f90

SUBROUTINE evaluate_matsubara_zz_1d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  COMPLEX(KIND=DP), INTENT(IN), TARGET :: arr (:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(1), output_dims_c(1)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 1
  IF (target_dim < 1 .or. target_dim > 1) THEN
    CALL errore('evaluate_matsubara_zz_1d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_zz_1d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_zz_1d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_zz_1d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_zz_1d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_zz_1d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_zz_1d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE

SUBROUTINE evaluate_matsubara_zz_2d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  COMPLEX(KIND=DP), INTENT(IN), TARGET :: arr (:,:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:,:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(2), output_dims_c(2)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 2
  IF (target_dim < 1 .or. target_dim > 2) THEN
    CALL errore('evaluate_matsubara_zz_2d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_zz_2d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_zz_2d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_zz_2d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_zz_2d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_zz_2d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_zz_2d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE

SUBROUTINE evaluate_matsubara_zz_3d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  COMPLEX(KIND=DP), INTENT(IN), TARGET :: arr (:,:,:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:,:,:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(3), output_dims_c(3)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 3
  IF (target_dim < 1 .or. target_dim > 3) THEN
    CALL errore('evaluate_matsubara_zz_3d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_zz_3d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_zz_3d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_zz_3d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_zz_3d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_zz_3d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_zz_3d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE

SUBROUTINE evaluate_matsubara_zz_4d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  COMPLEX(KIND=DP), INTENT(IN), TARGET :: arr (:,:,:,:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:,:,:,:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(4), output_dims_c(4)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 4
  IF (target_dim < 1 .or. target_dim > 4) THEN
    CALL errore('evaluate_matsubara_zz_4d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_zz_4d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_zz_4d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_zz_4d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_zz_4d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_zz_4d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_zz_4d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE

SUBROUTINE evaluate_matsubara_zz_5d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  COMPLEX(KIND=DP), INTENT(IN), TARGET :: arr (:,:,:,:,:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:,:,:,:,:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(5), output_dims_c(5)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 5
  IF (target_dim < 1 .or. target_dim > 5) THEN
    CALL errore('evaluate_matsubara_zz_5d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_zz_5d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_zz_5d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_zz_5d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_zz_5d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_zz_5d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_zz_5d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE

SUBROUTINE evaluate_matsubara_zz_6d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  COMPLEX(KIND=DP), INTENT(IN), TARGET :: arr (:,:,:,:,:,:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:,:,:,:,:,:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(6), output_dims_c(6)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 6
  IF (target_dim < 1 .or. target_dim > 6) THEN
    CALL errore('evaluate_matsubara_zz_6d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_zz_6d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_zz_6d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_zz_6d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_zz_6d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_zz_6d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_zz_6d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE

SUBROUTINE evaluate_matsubara_zz_7d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  COMPLEX(KIND=DP), INTENT(IN), TARGET :: arr (:,:,:,:,:,:,:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:,:,:,:,:,:,:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(7), output_dims_c(7)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 7
  IF (target_dim < 1 .or. target_dim > 7) THEN
    CALL errore('evaluate_matsubara_zz_7d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_zz_7d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_zz_7d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_zz_7d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_zz_7d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_zz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_zz_7d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_zz_7d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE

SUBROUTINE evaluate_matsubara_dz_1d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  REAL(KIND=DP), INTENT(IN), TARGET :: arr (:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(1), output_dims_c(1)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 1
  IF (target_dim < 1 .or. target_dim > 1) THEN
    CALL errore('evaluate_matsubara_dz_1d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_dz_1d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_dz_1d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_dz_1d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_dz_1d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_dz_1d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_dz_1d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE

SUBROUTINE evaluate_matsubara_dz_2d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  REAL(KIND=DP), INTENT(IN), TARGET :: arr (:,:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:,:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(2), output_dims_c(2)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 2
  IF (target_dim < 1 .or. target_dim > 2) THEN
    CALL errore('evaluate_matsubara_dz_2d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_dz_2d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_dz_2d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_dz_2d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_dz_2d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_dz_2d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_dz_2d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE

SUBROUTINE evaluate_matsubara_dz_3d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  REAL(KIND=DP), INTENT(IN), TARGET :: arr (:,:,:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:,:,:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(3), output_dims_c(3)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 3
  IF (target_dim < 1 .or. target_dim > 3) THEN
    CALL errore('evaluate_matsubara_dz_3d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_dz_3d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_dz_3d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_dz_3d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_dz_3d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_dz_3d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_dz_3d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE

SUBROUTINE evaluate_matsubara_dz_4d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  REAL(KIND=DP), INTENT(IN), TARGET :: arr (:,:,:,:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:,:,:,:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(4), output_dims_c(4)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 4
  IF (target_dim < 1 .or. target_dim > 4) THEN
    CALL errore('evaluate_matsubara_dz_4d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_dz_4d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_dz_4d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_dz_4d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_dz_4d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_dz_4d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_dz_4d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE

SUBROUTINE evaluate_matsubara_dz_5d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  REAL(KIND=DP), INTENT(IN), TARGET :: arr (:,:,:,:,:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:,:,:,:,:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(5), output_dims_c(5)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 5
  IF (target_dim < 1 .or. target_dim > 5) THEN
    CALL errore('evaluate_matsubara_dz_5d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_dz_5d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_dz_5d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_dz_5d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_dz_5d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_dz_5d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_dz_5d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE

SUBROUTINE evaluate_matsubara_dz_6d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  REAL(KIND=DP), INTENT(IN), TARGET :: arr (:,:,:,:,:,:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:,:,:,:,:,:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(6), output_dims_c(6)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 6
  IF (target_dim < 1 .or. target_dim > 6) THEN
    CALL errore('evaluate_matsubara_dz_6d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_dz_6d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_dz_6d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_dz_6d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_dz_6d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_dz_6d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_dz_6d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE

SUBROUTINE evaluate_matsubara_dz_7d(obj, statistics, target_dim, arr, res)
  TYPE(IR), INTENT(IN) :: obj
  INTEGER, INTENT(IN) :: statistics
  INTEGER, INTENT(IN) :: target_dim

  REAL(KIND=DP), INTENT(IN), TARGET :: arr (:,:,:,:,:,:,:)

  COMPLEX(KIND=DP), INTENT(OUT), TARGET :: res (:,:,:,:,:,:,:)
  INTEGER(KIND=c_int) :: ndim_c, target_dim_c, status_c
  INTEGER(KIND=c_int), TARGET :: input_dims_c(7), output_dims_c(7)
  input_dims_c = SHAPE(arr)
  output_dims_c = SHAPE(res)
  ndim_c = 7
  IF (target_dim < 1 .or. target_dim > 7) THEN
    CALL errore('evaluate_matsubara_dz_7d', 'Target dimension is out of range', 1)
  ENDIF
  IF (input_dims_c(target_dim) /= obj%size) THEN
    CALL errore('evaluate_matsubara_dz_7d', 'Target dimension is not the same as the basis size', 1)
  ENDIF
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_f) THEN
      CALL errore('evaluate_matsubara_dz_7d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  CASE (SPIR_STATISTICS_BOSONIC)
    IF (output_dims_c(target_dim) /= obj%nfreq_b) THEN
      CALL errore('evaluate_matsubara_dz_7d', 'Target dimension is not the same as the number of Matsubara frequencies', 1)
    ENDIF
  END SELECT
  IF (.NOT. check_output_dims(target_dim, input_dims_c, output_dims_c)) THEN
    CALL errore('evaluate_matsubara_dz_7d', &
        'Output dimensions are not the same as the input dimensions except for the TARGET dimension', 1)
  ENDIF
  target_dim_c = target_dim - 1
  SELECT CASE (statistics)
  CASE (SPIR_STATISTICS_FERMIONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_f_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE (SPIR_STATISTICS_BOSONIC)
    status_c = c_spir_sampling_eval_dz(obj%matsu_b_smpl_ptr, SPIR_ORDER_COLUMN_MAJOR, &
      ndim_c, c_loc(input_dims_c), target_dim_c, c_loc(arr), c_loc(res))
  CASE DEFAULT
    CALL errore('evaluate_matsubara_dz_7d', 'Invalid statistics', 1)
    RETURN
  END SELECT
  IF (status_c /= 0) THEN
    CALL errore('evaluate_matsubara_dz_7d', 'Error evaluating on Matsubara frequencies', status_c)
  ENDIF
END SUBROUTINE
